{% block styles %}
<link rel="stylesheet" href="{{ static 'main.css' }}" />
{% endblock %} {{ block content }}

<h2>{{page_title}}</h2>

<div class="card-section">
  <div class="card">
    <div class="form-group">
      <label class="form-label"> {{qu_identity}} </label>
      <div class="option-cards" data-field="feel_closest_party">
        {% for choice, label in choices_identity.items %}
        <label class="option-card">
          <input type="radio" name="feel_closest_party" value="{{ choice }}" />
          {{ label }}
        </label>
        {% endfor %}
      </div>
      {{ formfield_errors "feel_closest_party" }}
    </div>

    <p style="margin-bottom: -0.5em">{{qu_party_comment}}</p>
    {{formfield "party_comment"}}
  </div>
</div>

<div class="card-section">
  <div class="card">
    <label class="form-label">{{ lr_question }}</label>
    <input
      type="range"
      class="likert-slider"
      name="lrscale"
      id="sliderlr"
      min="0"
      max="10"
      step="1"
      style="color: #aaaaaa; background: #ccc"
      oninput="handleSliderInput(this.value)"
      required
    />
    <div
      style="display: flex; justify-content: space-between; margin-top: 10px"
    >
      <span style="font-size: 14pt; color: #777">{{ lr_first_label }}</span>
      <span style="font-size: 14pt; color: #777">{{ lr_last_label }}</span>
    </div>
    <div style="text-align: center; margin-top: 12px">
      {% if lan_en %} Selected value: {% else %} Ausgewählter Wert:
      {%endif%}<span id="sliderValue" style="color: #999"
        >{% if lan_en %}Please move the slider{% else %}Bitte bewegen Sie den
        Schieberegler{% endif %}</span
      >
    </div>
    {{ formfield_errors "lrscale" }}
  </div>
</div>

<br />

<div style="display: flex; justify-content: space-between; align-items: center">
  {% if lan_en %} {{ next_button }}
  <div style="margin-left: auto">Page {{nslide}}/{{maxslides}}</div>
  {% else %}
  <button
    type="submit"
    class="otree-btn-next btn btn-primary big-button"
    id="nextButton"
    disabled
    style="opacity: 0.5"
  >
    Weiter
  </button>
  <div style="margin-left: auto">Seite {{nslide}}/{{maxslides}}</div>
  {% endif %}
</div>

<script>
  document.querySelectorAll(".option-cards").forEach((group) => {
    const name = group.dataset.field;
    group.querySelectorAll('input[type="radio"]').forEach((radio) => {
      radio.addEventListener("change", () => {
        group.querySelectorAll(".option-card").forEach((card) => {
          card.classList.remove("selected");
        });
        radio.closest(".option-card").classList.add("selected");
      });
    });
  });
</script>

<script>
  // Form validation before submission
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    if (form) {
      form.addEventListener('submit', function(e) {
        if (!sliderTouched) {
          e.preventDefault();
          const lang = {% if lan_en %}true{% else %}false{% endif %};
          alert(lang ? 'Please move the slider to select a value.' : 'Bitte bewegen Sie den Schieberegler, um einen Wert auszuwählen.');
          return false;
        }
      });
    }
  });
</script>

<script>
  let sliderTouched = false;

  function handleSliderInput(value) {
    sliderTouched = true;

    // Update the displayed value
    document.getElementById(
      "sliderValue"
    ).textContent = `${value}{% if lan_en %} of {% else %} von {%endif%} 10`;
    document.getElementById("sliderValue").style.color = "black";

    // Enable the next button
    const nextButton = document.getElementById("nextButton");
    if (nextButton) {
      nextButton.disabled = false;
      nextButton.style.opacity = "1";
    }

    // Update slider styling
    const slider = document.getElementById("sliderlr");
    const val = parseFloat(value);
    const min = parseFloat(slider.min),
      max = parseFloat(slider.max);
    const mid = (min + max) / 2;
    const sliderColor = "#424242ff";

    // compute fill percentages from center
    const l =
      val < mid ? Math.max(0, 50 + ((val - mid) / (mid - min)) * 50) : 50;
    const r =
      val < mid ? 50 : Math.min(100, 50 + ((val - mid) / (max - mid)) * 50);
    slider.style.color = "black";
    slider.style.background = `linear-gradient(to right,
        #e0e0e0 0%, #e0e0e0 ${l}%,
        ${sliderColor} ${l}%, ${sliderColor} ${r}%,
        #e0e0e0 ${r}%, #e0e0e0 100%)`;
  }
</script>

{{ endblock }}
