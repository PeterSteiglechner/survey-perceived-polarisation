{% block styles %}
<link rel="stylesheet" href="{{ static 'main.css' }}" />
{% endblock %} {{ block content }}

<h2>{{page_title}}</h2>

<div class="card-section">
  <!-- Demographic Card -->
  <div class="card">
    <label class="form-label"> {{qu_age}} </label>
    <div class="form-group">
      {% formfield player.age %} {{ formfield_errors "age" }}
    </div>
  </div>

  <!-- Interest Card -->
  <div class="card">
  <form method="post">
      <label class="form-label"> {{qu_interest}} </label>
      <div
        style="
          display: flex;
          justify-content: space-between;
          margin-top: 0px;
          margin-bottom: -3px;
        "
      >
        <span style="font-size: 10pt; color: #999"
          >{{ interest_min_label }}</span
        >
        <span style="font-size: 10pt; color: #999"
          >{{ interest_max_label }}</span
        >
      </div>
      <input
        type="range"
        class="likert-slider"
        name="political_interest"
        id="slider_political_interest"
        min="{{interest_min}}"
        max="{{interest_max}}"
        step="1"
        required
        oninput="handleSliderInput('political_interest', this.value)"
      />
      <div
        class="slider-label"
        style="text-align: center; margin-top: 0pt; margin-bottom: 0pt"
      >
        <p style="color: #999; font-size: 10pt">
          {% if lan_en %} Selected: {% else %} Ausgewählt: {%endif%}
          <span id="sliderValuepolitical_interest" style="color: #999; font-size: 10pt">
            <strong>
              {% if lan_en %}Please move the slider{% else %}Bitte bewegen Sie
              den Schieberegler{% endif %}
            </strong>
          </span>
        </p>
      </div>

      {{ formfield_errors "political_interest" }}
    </div>
  </form>
  </div>
<!-- Interest Card -->
  <div class="card">
  <form method="post">
      <label class="form-label"> {{qu_polarization}} </label>
      <div
        style="
          display: flex;
          justify-content: space-between;
          margin-top: 0px;
          margin-bottom: -3px;
        "
      >
        <span style="font-size: 10pt; color: #999"
          >{{ polarised_min_label }}</span
        >
        <span style="font-size: 10pt; color: #999"
          >{{ polarised_max_label }}</span
        >
      </div>
      <input
        type="range"
        class="likert-slider"
        name="how_polarised"
        id="slider_how_polarised"
        min="{{polarised_min}}"
        max="{{polarised_max}}"
        step="1"
        required
        oninput="handleSliderInput('how_polarised', this.value)"
      />
      <div
        class="slider-label"
        style="text-align: center; margin-top: 0pt; margin-bottom: 0pt"
      >
        <p style="color: #999; font-size: 10pt">
          {% if lan_en %} Selected: {% else %} Ausgewählt: {%endif%}
          <span id="sliderValuehow_polarised" style="color: #999; font-size: 10pt">
            <strong>
              {% if lan_en %}Please move the slider{% else %}Bitte bewegen Sie
              den Schieberegler{% endif %}
            </strong>
          </span>
        </p>
      </div>

      {{ formfield_errors "how_polarised" }}
    </div>
  </form>
  </div>

</div>

<br />

<div style="display: flex; justify-content: space-between; align-items: center">
  {% if lan_en %}
  <button type="submit" class="otree-btn-next btn btn-primary big-button">
    Complete survey
  </button>
  <div style="margin-left: auto">Page {{nslide}}/{{maxslides}}</div>
  {% else %}
  <button type="submit" class="otree-btn-next btn btn-primary big-button">
    Umfrage abschließen
  </button>
  <div style="margin-left: auto">Seite {{nslide}}/{{maxslides}}</div>
  {% endif %}
</div>




<script>
  let slidersTouched = {};
  let totalSliders = 0;

  function handleSliderInput(field, value) {
      slidersTouched[field] = true;
      const numVal = parseInt(value, 10);
      const span = document.getElementById('sliderValue' + field);
      if (span) {
          span.innerHTML = `<strong>${Math.round(value/10)}</strong> / 10`;
          span.style.color = 'black';
      }

      // update slider gradient
      const slider = document.getElementById('slider_' + field);
      if (slider) {
          const val = parseFloat(value);
          const min = parseFloat(slider.min), max = parseFloat(slider.max);
          const sliderColor = "#007bff";

          const l = 0;
          const r = Math.min(100, val);

          slider.style.background = `linear-gradient(to right,
            #e0e0e0 0%, #e0e0e0 ${l}%,
            ${sliderColor} ${l}%, ${sliderColor} ${r}%,
            #e0e0e0 ${r}%, #e0e0e0 100%)`;
      }

      // enable next button if all touched
      if (Object.keys(slidersTouched).length === totalSliders) {
          const nextButton = document.getElementById('nextButton') || document.querySelector('.otree-btn-next');
          if (nextButton) {
              nextButton.disabled = false;
              nextButton.style.opacity = '1';
          }
      }
  }

  document.addEventListener('DOMContentLoaded', function() {
      totalSliders = document.querySelectorAll('.likert-slider').length;

      const form = document.querySelector('form');
      if (form) {
          form.addEventListener('submit', function(e) {
              if (Object.keys(slidersTouched).length < totalSliders) {
                  e.preventDefault();
                  alert({% if lan_en %}'Please move all sliders to select values.'{% else %}'Bitte bewegen Sie alle Schieberegler, um Werte auszuwählen.'{% endif %});
                  return false;
              }
          });
      }

      const nextButton = document.getElementById('nextButton') || document.querySelector('.otree-btn-next');
      if (nextButton) {
          nextButton.disabled = true;
          nextButton.style.opacity = '0.5';
      }
  });
</script>



<script>
  document.querySelectorAll(".option-cards").forEach((group) => {
    const name = group.dataset.field;
    group.querySelectorAll('input[type="radio"]').forEach((radio) => {
      radio.addEventListener("change", () => {
        group.querySelectorAll(".option-card").forEach((card) => {
          card.classList.remove("selected");
        });
        radio.closest(".option-card").classList.add("selected");
      });
    });
  });
</script>

{{ endblock }}
