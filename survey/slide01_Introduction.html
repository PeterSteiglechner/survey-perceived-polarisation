{% block styles %}
    <link rel="stylesheet" href="{{ static 'main.css' }}">
{% endblock %}

{% block content %}

<h2>Welcome to our survey on the perception of political opinions!<br>Willkommen zu unserer Umfrage zu Wahrnehmung von politischen Meinungen!
</h2>


<!-- Language Selection -->
<div class="language-section">
    <div class="card">
        <div class="form-group">
            <label class="form-label" data-i18n="selectLanguage">Please select your preferred language / Bitte wählen Sie Ihre bevorzugte Sprache:</label>
            <div class="option-cards" data-field="language">
                <label class="option-card">
                    <input type="radio" name="language" value="en"> English
                </label>
                <label class="option-card">
                    <input type="radio" name="language" value="de"> Deutsch
                </label>
            </div>
        </div>
    </div>
</div>

<br>

<!-- Consent Section -->
<div class="consent-section" id="consent-section" style="display: none;">
    <div class="card">
        <div class="form-group">
            <h3 data-i18n="consentTitle"></h3>
            <p data-i18n="dearParticipant"></p>
            <p data-i18n="consentText"></p>

            <p><strong data-i18n="purposeTitle"></strong></p>
            <p data-i18n="purposeBody"></p>
            <p data-i18n="rightWrong"></p>
            <p data-i18n="benefitsBody1"></p>
            
            <p><strong data-i18n="eligibility"></strong></p>
            <p data-i18n="eligibilityBody"></p>
            

            <p><strong data-i18n="procedureTitle"></strong></p>
            <p data-i18n="procedureBody"></p>

            <p data-i18n="duration"></p>

            <p><strong data-i18n="paymentTitle"></strong></p>
            <p data-i18n="paymentBody"></p>

            <p><strong data-i18n="withdrawal"></strong></p>
            <p data-i18n="withdrawalInfo"></p>
            <p data-i18n="contactInfo"></p><p style="margin-top:-1em"><a href='mailto:collectivemindslab@csh.ac.at'>collectivemindslab@csh.ac.at</a></p>

            <p><strong data-i18n="dataUsageTitle"></strong></p>
            <p data-i18n="dataUsage1"></p>
            <p data-i18n="dataUsage2"></p>
            <p data-i18n="dataUsage3"></p>
            <p data-i18n="dataUsage4"></p>

            <p><strong data-i18n="questionsTitle"></strong></p>
            <p data-i18n="questionsBody"></p><p style="margin-top:-1em"><a href='mailto:collectivemindslab@csh.ac.at'>collectivemindslab@csh.ac.at</a></p>

            <p data-i18n="ethicsReview"></p>
{% comment %} 
            <div class="instructions">
                <p data-i18n="consentDisclaimer"></p>
            </div> {% endcomment %}
            
            <div class="instructions" style="margin: 10px 0; padding: 10px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 4px;">
                <p data-i18n="consentDecl"></p>
            </div>

                <div class="option-cards" data-field="consent">
                    <label class="option-card">
                        <input type="radio" name="consent" value="1">
                        <span data-i18n="consentYes"></span>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="consent" value="0">
                        <span data-i18n="consentNo"></span>
                    </label>
                </div>
            </div>
        </div>
    </div>
</div>

<br>

<div style="display: flex; justify-content: space-between; align-items: center;">
    {{ next_button }}
    <div id="pagedispl"></div>
</div>



<script>
const translations = {
    en: {
        welcomeTitle: "Welcome to our survey on the perception of political opinions!",
        selectLanguage: "Please select your preferred language:",
        consentTitle: "Consent",
        dearParticipant: "Dear participant,",
        consentText: "Thank you for participating in our survey. Please read the following and indicate your consent.",
        purposeTitle: "What is the purpose of this study?",
        purposeBody: "The purpose of this study is to explore how people perceive and interpret political differences or similarities based on how they view other people's political opinions. ",
        benefitsBody1: "The findings from this project will provide information on whether people perceive opinions and polarisation in society similarly or whether there are systematic differences in perception.",
        eligibility: "Eligibility:", 
        eligibilityBody: "You are eligible to take part in this study because you are living in Germany and are at least 18 years old.",
        procedureTitle: "What is the procedure of the study?",
        procedureBody: "Firstly, we will ask you a few questions about your political views. Then we ask you to name 6 people you know well. We ask you to assess what political attitudes these people have. We also ask you to estimate how typical voters of the Greens, the AfD, the Left or the FDP would answer. In the main section, you position these opinions on a political map. Finally, there are a few short, more specific questions about your perception of political distance and a few questions about yourself.",
        rightWrong: "There are no right or wrong answers. We are interested in your personal perceptions.",
        duration: "The study will last for about 30 minutes.",
        paymentTitle: "Payment:",
        paymentBody: "You will be compensated for the duration of the study according to standard hourly rates: 6 USD for 30 minutes.",
        withdrawal: "Can I withdraw?",
        withdrawalInfo: "Your participation in this research study is voluntary. You may refuse to participate or stop at any time without penalty.",
        contactInfo: "If you complete the study but want your data removed, please contact the study coordinators Mirta Galesic and Peter Steiglechner within 30 days at",
        dataUsageTitle: "How will the data collected in this study be used?",
        dataUsage1: "All metadata collected in this study that could identify you—such as your Prolific ID—will be kept strictly confidential and only disclosed with your explicit permission.",
        dataUsage2: "Identifying information is stored separately from your survey responses and will not be included in any published or shared data.",
        dataUsage3: "Your anonymized data may be shared in an Open Data Repository for non-commercial, scientific use.",
        dataUsage4: "Your personal data will never be used for purposes that are incompatible with the goals of this study.",
        questionsTitle: "Possibility to discuss further questions",
        questionsBody: "If you have any further questions about the study, please contact the study coordinators Mirta Galesic and Peter Steiglechner at",
        ethicsReview: "This study has been reviewed by the UNM IRB 2501179238A001.",
        consentDecl: "I have read the information provided above. By clicking 'I give consent' I indicate my voluntary agreement to participate in this research study.",
        consentYes: "I give consent.",
        consentNo: "I do not give consent.",
        nextBtn: "Next",
        pageText: "Page 1/21"
    },
    de: {
        welcomeTitle: "Willkommen zu unserer Umfrage zu Wahrnehmung von politischen Meinungen!",
        selectLanguage: "Bitte wählen Sie Ihre bevorzugte Sprache:",
        consentTitle: "Einverständnis",
        dearParticipant: "Liebe Teilnehmerin, lieber Teilnehmer,",
        consentText: "Vielen Dank für die Teilnahme an unserer Umfrage. Bitte lesen Sie das Folgende und geben Sie Ihr Einverständnis.",
        purposeTitle: "Was ist das Ziel dieser Studie?",
        purposeBody: "Das Ziel dieser Studie ist es, zu erforschen, wie Menschen politische Unterschiede oder Gemeinsamkeiten wahrnehmen, basierend auf den politischen Meinungen von anderen. Sie nehmen teil, weil Sie in Deutschland leben und mindestens 18 Jahre alt sind.",
        rightWrong: "Es gibt keine richtigen oder falschen Antworten. Wir sind ausschließlich an Ihren eigenen Wahrnehmungen interessiert.",
        benefitsBody1: "Die Ergebnisse dieser Studie werden zeigen, ob Menschen politische Meinungen und Polarisierung ähnlich wahrnehmen oder ob es systematische Unterschiede in der Wahrnehmung gibt.",
        eligibility: "Teilnahmebedingungen:",
        eligibilityBody: "Sie sind zur Teilnahme an dieser Studie berechtigt, da Sie in Deutschland leben und mindestens 18 Jahre alt sind.",
        procedureTitle: "Wie läuft die Studie ab?",
        procedureBody: "Zuerst stellen wir Ihnen ein paar Fragen zu Ihren politischen Einstellungen. Dann bitten wir Sie, 6 Personen zu nennen, die Sie gut kennen. Wir bitten Sie einzuschätzen, welche politischen Einstellungen diese Personen haben. Außerdem bitten wir Sie einzuschätzen, wie typische Wähler oder Wählerinnen der Grünen, der AfD, der Linken oder der FDP antworten würden. Im Hauptteil ordnen Sie diese Meinungen auf einer politischen Karte ein. Zum Schluss folgen ein paar kurze konkretere Fragen zu Ihrer Wahrnehmung von politischer Distanz und ein paar Fragen über Sie selbst.",
        duration: "Die Studie dauert etwa 30 Minuten.",
        paymentTitle: "Vergütung:",
        paymentBody: "Sie erhalten eine Aufwandsentschädigung entsprechend der Studiendauer: 6 USD für ca. 30 Minuten Teilnahme.",
        withdrawal: "Kann ich die Studie abbrechen?",
        withdrawalInfo: "Die Teilnahme ist freiwillig. Sie können jederzeit ohne Angabe von Gründen abbrechen.",
        contactInfo: "Wenn Sie Ihre Daten nach Abschluss löschen lassen möchten, kontaktieren Sie die Koordinator:innen der Studie Mirta Galesic und Peter Steiglechner innerhalb von 30 Tagen unter",
        dataUsageTitle: "Wie werden die gesammelten Daten verwendet?",
        dataUsage1: "Personenbezogene Metadaten wie Ihre Prolific ID werden streng vertraulich behandelt und nur mit Ihrer Zustimmung weitergegeben.",
        dataUsage2: "Identifizierende Informationen werden getrennt gespeichert und nicht veröffentlicht.",
        dataUsage3: "Anonymisierte Daten können in Open-Data-Repositorien zu wissenschaftlichen Zwecken geteilt werden.",
        dataUsage4: "Ihre Daten werden niemals zweckentfremdet.",
        questionsTitle: "Möglichkeit zur Rückfrage",
        questionsBody: "Bei Fragen wenden Sie sich bitte an die Koordinator:innen der Studie Mirta Galesic und Peter Steiglechner unter",
        ethicsReview: "Diese Studie wurde von dem Ethikkomitee der University of New Mexico (UNM IRB 2501179238A001) geprüft.",
        consentDecl: "Ich habe die oben stehenden Informationen gelesen. Durch einen Klick auf 'Ich gebe mein Einverständnis' erkläre ich mich freiwillig bereit, an dieser Studie teilzunehmen.",
        consentYes: "Ich gebe mein Einverständnis.",
        consentNo: "Ich gebe mein Einverständnis nicht.",
        nextBtn: "Weiter",
        pageText: "Seite 1/21"
    }
};

    // Initially hide oTree's next button
    document.addEventListener("DOMContentLoaded", function () {
        const nextButton = document.querySelector('button[type="submit"]');

        // Handle language + consent selection
        document.querySelectorAll('.option-cards').forEach(group => {
            const field = group.dataset.field;
            group.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    // Remove all selected
                    group.querySelectorAll('.option-card').forEach(card => card.classList.remove('selected'));
                    radio.closest('.option-card').classList.add('selected');

                    if (field === 'language') {
                        document.getElementById('consent-section').style.display = 'block';
                        updateLanguage(radio.value);
                    }
                });
            });
        });
    });



        function updateLanguage(lang) {
            const elements = document.querySelectorAll('[data-i18n]');
            elements.forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });
        }

        // Option card selection handling
        document.querySelectorAll('.option-cards').forEach(group => {
            const field = group.dataset.field;
            group.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    // Remove all selected
                    group.querySelectorAll('.option-card').forEach(card => card.classList.remove('selected'));
                    // Add selected class to the parent
                    radio.closest('.option-card').classList.add('selected');

                    // Handle language change
                    if (field === 'language') {
                        document.getElementById('consent-section').style.display = 'block';
                        updateLanguage(radio.value);
                    }
                });
            });
        });
</script>
{% endblock %}